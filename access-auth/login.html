<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CEMS - Secure Login</title>
  <link rel="stylesheet" href="../css/cems.css">
  <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
  <style>
    body {
      background: linear-gradient(135deg, #F8F9FA 0%, #E5E7EB 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    .login-container {
      background: white;
      border-radius: 8px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      max-width: 1000px;
      width: 100%;
      overflow: hidden;
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    .login-section {
      padding: 48px;
    }

    .biometric-section {
      background: #F8F9FA;
      border-right: 1px solid #E5E7EB;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    .fingerprint-scanner {
      width: 180px;
      height: 180px;
      background: white;
      border: 4px solid #2563EB;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.3s ease;
      margin: 24px 0;
      position: relative;
    }

    .fingerprint-scanner:hover {
      background: #EFF6FF;
      border-color: #1D4ED8;
      transform: scale(1.05);
    }

    .fingerprint-scanner.scanning {
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7);
      }
      50% {
        box-shadow: 0 0 0 15px rgba(37, 99, 235, 0);
      }
    }

    .logo-circle {
      width: 80px;
      height: 80px;
      background: #2563EB;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 24px;
    }

    .system-title {
      font-size: 24px;
      font-weight: 600;
      color: #111827;
      margin-bottom: 8px;
    }

    .system-subtitle {
      font-size: 14px;
      color: #6B7280;
      margin-bottom: 32px;
    }

    .access-info {
      background: #FEF3C7;
      border: 1px solid #FCD34D;
      border-radius: 6px;
      padding: 12px;
      margin-top: 24px;
      text-align: left;
      width: 100%;
    }

    .footer-text {
      text-align: center;
      font-size: 12px;
      color: #9CA3AF;
      margin-top: 32px;
    }

    @media (max-width: 768px) {
      .login-container {
        grid-template-columns: 1fr;
      }
      .biometric-section {
        border-right: none;
        border-bottom: 1px solid #E5E7EB;
      }
      .login-section {
        padding: 32px 24px;
      }
    }
  </style>
</head>
<body>

  <div class="login-container">

    <!-- Left: Biometric Authentication -->
    <div class="login-section biometric-section">

      <!-- Logo -->
      <div class="logo-circle">
        <i data-feather="book-open" style="width: 40px; height: 40px; color: white;"></i>
      </div>

      <div class="system-title">CEMS</div>
      <div class="system-subtitle">College Exam Management System</div>

      <h2 style="font-size: 18px; font-weight: 600; color: #111827; margin-bottom: 8px;">Biometric Authentication</h2>
      <p style="font-size: 13px; color: #6B7280; margin-bottom: 24px;">Secure fingerprint-based login</p>

      <!-- Fingerprint Scanner -->
      <div class="fingerprint-scanner" id="fingerprintScanner" onclick="startScan()">
        <i data-feather="fingerprint" style="width: 100px; height: 100px; color: #2563EB;"></i>
      </div>

      <p style="font-size: 14px; font-weight: 500; color: #111827; margin-bottom: 4px;">Place your finger on the scanner</p>
      <p style="font-size: 12px; color: #6B7280; margin-bottom: 24px;">Ensure finger is clean and dry</p>

      <!-- Scan Status -->
      <div id="scanStatus" style="display: none; margin-bottom: 16px;">
        <span class="status status-info">
          <span class="status-dot"></span>
          <span id="statusText">Scanning...</span>
        </span>
      </div>

      <!-- Location Verification Status -->
      <div style="margin-bottom: 16px; padding: 12px; background: #F0FDF4; border: 1px solid #86EFAC; border-radius: 6px;">
        <div style="display: flex; align-items: center; gap: 8px;">
          <i data-feather="map-pin" style="width: 16px; height: 16px; color: #22C55E;"></i>
          <div style="font-size: 13px; color: #166534;">
            <strong>Location Verified:</strong> College Campus Network
          </div>
        </div>
      </div>

      <!-- OTP Fallback -->
      <button class="btn btn-secondary btn-sm">
        <i data-feather="smartphone" style="width: 16px; height: 16px;"></i>
        Request OTP Instead
      </button>

      <!-- Access Info Alert -->
      <div class="access-info">
        <div style="display: flex; gap: 8px;">
          <i data-feather="alert-circle" style="width: 16px; height: 16px; color: #F59E0B; flex-shrink: 0; margin-top: 2px;"></i>
          <div style="font-size: 12px; color: #92400E;">
            <strong>Premises-Only Access:</strong> This system can only be accessed from within the college campus network.
          </div>
        </div>
      </div>

    </div>

    <!-- Right: Manual Login -->
    <div class="login-section">

      <h2 style="font-size: 20px; font-weight: 600; color: #111827; margin-bottom: 8px;">Manual Login</h2>
      <p style="font-size: 13px; color: #6B7280; margin-bottom: 32px;">Use your credentials if biometric scanner is unavailable</p>

      <form onsubmit="handleLogin(event)">

        <!-- User ID -->
        <div class="form-group">
          <label class="form-label required">User ID</label>
          <input type="text" class="form-input" id="userId" placeholder="Enter your user ID" required />
        </div>

        <!-- Password -->
        <div class="form-group">
          <label class="form-label required">Password</label>
          <input type="password" class="form-input" id="password" placeholder="Enter your password" required />
        </div>

        <!-- OTP (if fallback) -->
        <div class="form-group" id="otpField" style="display: none;">
          <label class="form-label required">OTP</label>
          <input type="text" class="form-input" id="otp" placeholder="Enter 6-digit OTP" maxlength="6" />
          <div style="font-size: 12px; color: #6B7280; margin-top: 4px;">OTP sent to your registered mobile number</div>
        </div>

        <!-- Remember Me & Forgot Password -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px;">
          <label style="display: flex; align-items: center; font-size: 13px; color: #6B7280; cursor: pointer;">
            <input type="checkbox" style="margin-right: 8px;" />
            Remember me
          </label>
          <a href="#" style="font-size: 13px; color: #2563EB; text-decoration: none;">Forgot password?</a>
        </div>

        <!-- Login Button -->
        <button type="submit" class="btn btn-primary" style="width: 100%;">
          <i data-feather="log-in" style="width: 16px; height: 16px;"></i>
          Login
        </button>

        <!-- Role Selection (hidden until login - for demo purposes) -->
        <div id="roleSelection" style="display: none; margin-top: 24px;">
          <label class="form-label">Select Your Role</label>
          <select class="form-select" id="userRole">
            <option value="">-- Select Role --</option>
            <option value="super_admin">Super Admin</option>
            <option value="exam_controller">Exam Controller</option>
            <option value="deputy_controller">Deputy Controller</option>
            <option value="assistant_controller">Assistant Controller</option>
            <option value="data_entry_operator">Data Entry Operator</option>
          </select>
          <button type="button" class="btn btn-primary" style="width: 100%; margin-top: 12px;" onclick="proceedToDashboard()">
            Proceed to Dashboard
          </button>
        </div>

      </form>

      <!-- Support Info -->
      <div class="footer-text">
        <p style="margin-bottom: 4px;">Having trouble logging in?</p>
        <p>Contact IT Support: <a href="mailto:support@sgcei.edu.in" style="color: #2563EB;">support@sgcei.edu.in</a> | Ext: 1234</p>
        <p style="margin-top: 12px; font-size: 11px;">SGC Educational Institute Â© 2024-25</p>
      </div>

    </div>

  </div>

  <script src="../js/cems.js"></script>
  <script>
    feather.replace();

    let scanInProgress = false;

    function startScan() {
      if (scanInProgress) return;

      const scanner = document.getElementById('fingerprintScanner');
      const statusDiv = document.getElementById('scanStatus');
      const statusText = document.getElementById('statusText');

      scanner.classList.add('scanning');
      statusDiv.style.display = 'block';
      scanInProgress = true;

      // Simulate scanning process
      setTimeout(() => {
        statusText.textContent = 'Fingerprint detected...';
        setTimeout(() => {
          statusText.textContent = 'Verifying identity...';
          setTimeout(() => {
            // Simulate successful authentication
            scanner.classList.remove('scanning');
            statusDiv.innerHTML = '<span class="status status-approved"><span class="status-dot"></span>Authentication successful!</span>';

            setTimeout(() => {
              // Redirect to dashboard
              window.location.href = '../dashboard.html';
            }, 1500);
          }, 1000);
        }, 1000);
      }, 1500);
    }

    function handleLogin(event) {
      event.preventDefault();

      const userId = document.getElementById('userId').value;
      const password = document.getElementById('password').value;

      // Basic validation (in real system, this would call backend API)
      if (userId && password) {
        // Show role selection for demo
        document.getElementById('roleSelection').style.display = 'block';
      } else {
        alert('Please enter both User ID and Password');
      }
    }

    function proceedToDashboard() {
      const role = document.getElementById('userRole').value;
      if (role) {
        // In real system, this would be set via session/JWT token
        localStorage.setItem('userRole', role);
        window.location.href = '../dashboard.html';
      } else {
        alert('Please select your role');
      }
    }

    // Failed attempt tracking
    let failedAttempts = 0;
    const maxAttempts = 3;

    function trackFailedAttempt() {
      failedAttempts++;
      if (failedAttempts >= maxAttempts) {
        alert('Account locked due to multiple failed attempts. Please contact IT Support.');
        document.querySelector('form').style.display = 'none';
      }
    }

    // Auto-logout reminder
    console.log('Session will auto-logout after 30 minutes of inactivity');
  </script>

</body>
</html>
